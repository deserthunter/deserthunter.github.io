<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>AST树 | Note</title>
    <meta name="generator" content="VuePress 1.5.0">
    
    <meta name="description" content="Wesely Note">
    <link rel="preload" href="/NotePro/assets/css/0.styles.84c2a560.css" as="style"><link rel="preload" href="/NotePro/assets/js/app.842cebdb.js" as="script"><link rel="preload" href="/NotePro/assets/js/2.51c83669.js" as="script"><link rel="preload" href="/NotePro/assets/js/6.9517a1cc.js" as="script"><link rel="prefetch" href="/NotePro/assets/js/10.74f417bc.js"><link rel="prefetch" href="/NotePro/assets/js/11.ede4817e.js"><link rel="prefetch" href="/NotePro/assets/js/12.8c45ba99.js"><link rel="prefetch" href="/NotePro/assets/js/13.e1e9951c.js"><link rel="prefetch" href="/NotePro/assets/js/14.dde976bf.js"><link rel="prefetch" href="/NotePro/assets/js/15.638eb3b0.js"><link rel="prefetch" href="/NotePro/assets/js/16.281e02be.js"><link rel="prefetch" href="/NotePro/assets/js/17.5483bdb8.js"><link rel="prefetch" href="/NotePro/assets/js/18.0fdae569.js"><link rel="prefetch" href="/NotePro/assets/js/19.9350b2bc.js"><link rel="prefetch" href="/NotePro/assets/js/3.3a265e35.js"><link rel="prefetch" href="/NotePro/assets/js/4.678c9681.js"><link rel="prefetch" href="/NotePro/assets/js/5.4f80a4a4.js"><link rel="prefetch" href="/NotePro/assets/js/7.4215e4a4.js"><link rel="prefetch" href="/NotePro/assets/js/8.b1ddaf20.js"><link rel="prefetch" href="/NotePro/assets/js/9.56e85243.js">
    <link rel="stylesheet" href="/NotePro/assets/css/0.styles.84c2a560.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/NotePro/" class="home-link router-link-active"><!----> <span class="site-name">Note</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/NotePro/" class="nav-link">
  主页
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/NotePro/" class="nav-link">
  主页
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/NotePro/notes/React/react.html" class="sidebar-link">React笔记</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/NotePro/notes/React/react.html#react" class="sidebar-link">React</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/NotePro/notes/React/react.html#状态组件" class="sidebar-link">- 状态组件</a></li><li class="sidebar-sub-header"><a href="/NotePro/notes/React/react.html#数据是向下流动的-单向数据流" class="sidebar-link">- 数据是向下流动的 (单向数据流)</a></li><li class="sidebar-sub-header"><a href="/NotePro/notes/React/react.html#受控组件-状态提升" class="sidebar-link">- 受控组件[状态提升]</a></li><li class="sidebar-sub-header"><a href="/NotePro/notes/React/react.html#组合-vs-继承" class="sidebar-link">- 组合 vs 继承</a></li><li class="sidebar-sub-header"><a href="/NotePro/notes/React/react.html#context" class="sidebar-link">- context *</a></li><li class="sidebar-sub-header"><a href="/NotePro/notes/React/react.html#refs" class="sidebar-link">- Refs</a></li><li class="sidebar-sub-header"><a href="/NotePro/notes/React/react.html#高阶组件" class="sidebar-link">- 高阶组件</a></li><li class="sidebar-sub-header"><a href="/NotePro/notes/React/react.html#portals" class="sidebar-link">- Portals  *</a></li><li class="sidebar-sub-header"><a href="/NotePro/notes/React/react.html#render-props" class="sidebar-link">- Render Props</a></li><li class="sidebar-sub-header"><a href="/NotePro/notes/React/react.html#严格模式" class="sidebar-link">- 严格模式 :</a></li></ul></li><li class="sidebar-sub-header"><a href="/NotePro/notes/React/react.html#redux" class="sidebar-link">Redux</a></li><li class="sidebar-sub-header"><a href="/NotePro/notes/React/react.html#redux-saga" class="sidebar-link">Redux-saga</a></li></ul></li><li><a href="/NotePro/notes/React/react-source.html" class="sidebar-link">React源码解析</a></li><li><a href="/NotePro/notes/Vue/vue.html" class="sidebar-link">Vue笔记</a></li><li><a href="/NotePro/notes/Vue/vue-source.html" class="sidebar-link">Vue源码解析</a></li><li><a href="/NotePro/notes/Flutter/" class="sidebar-link">Flutter笔记</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/NotePro/notes/Flutter/#flutter" class="sidebar-link">Flutter</a></li></ul></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Flutter源码解析</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Backbone源码解析</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/NotePro/notes/Browser/" class="sidebar-link">浏览器相关</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/NotePro/notes/Browser/#browser" class="sidebar-link">Browser</a></li></ul></li><li><a href="/NotePro/notes/Measure/" class="sidebar-link">CI/DI</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/NotePro/notes/Measure/#前端自动化分类" class="sidebar-link">前端自动化分类</a></li><li class="sidebar-sub-header"><a href="/NotePro/notes/Measure/#前端自动化实践" class="sidebar-link">前端自动化实践</a></li></ul></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>webpack相关</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/NotePro/notes/Other/" class="sidebar-link">其他</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/NotePro/notes/Other/#本地npm库搭建-自己的服务器" class="sidebar-link">本地npm库搭建[自己的服务器]</a></li></ul></li><li><a href="/NotePro/notes/CSS/" class="sidebar-link">CSS/CSS3</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>TypeScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>组件化组件</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/NotePro/notes/Performance/" class="sidebar-link">性能调优</a></li><li><a href="/NotePro/notes/Ast/" aria-current="page" class="active sidebar-link">AST</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/NotePro/notes/Ast/#ast树" class="sidebar-link">AST树</a></li><li class="sidebar-sub-header"><a href="/NotePro/notes/Ast/#javascript-编译" class="sidebar-link">javascript 编译</a></li><li class="sidebar-sub-header"><a href="/NotePro/notes/Ast/#javascript引擎" class="sidebar-link">JavaScript引擎</a></li><li class="sidebar-sub-header"><a href="/NotePro/notes/Ast/#webassemble" class="sidebar-link">WebAssemble</a></li><li class="sidebar-sub-header"><a href="/NotePro/notes/Ast/#llvm" class="sidebar-link">LLVM</a></li></ul></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SOA/微服务</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>python笔记</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>python实战案例</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>java笔记</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>java实战案例</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Go笔记</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Go实战案例</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="ast树"><a href="#ast树" class="header-anchor">#</a> AST树</h2> <h6 id="示例"><a href="#示例" class="header-anchor">#</a> <a href="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/SpiderMonkey/Parser_API#Node_objects" target="_blank" rel="noopener noreferrer">示例<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h6> <div class="language- line-numbers-mode"><pre class="language-text"><code>function add(a, b) {
    return a + b
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h6 id="ast-解析库"><a href="#ast-解析库" class="header-anchor">#</a> AST 解析库</h6> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm i recast -S
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>解析javascript 源码</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>//recast
const recast = require(&quot;recast&quot;);
// 我们使用了很奇怪格式的代码，想测试是否能维持代码结构
const code =
  `
  function add(a, b) {
    return a +
      // 有什么奇怪的东西混进来了
      b
  }
  `
// 解析机器
const ast = recast.parse(code);
// ast可以处理很巨大的代码文件
// 但我们现在只需要代码块的第一个body，即add函数
const add  = ast.program.body[0]
console.log(add)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><ul><li>承接上面代码输出,还原为函数</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>// 引入变量声明，变量符号，函数声明三种“模具”
const {variableDeclaration, variableDeclarator, functionExpression} = recast.types.builders

// 将准备好的组件置入模具，并组装回原来的ast对象。
ast.program.body[0] = variableDeclaration(&quot;const&quot;, [
  variableDeclarator(add.id, functionExpression(
    null, // Anonymize the function expression.
    add.params,
    add.body
  ))
]);

//将AST对象重新转回可以阅读的代码  
//如果想要合适完美，可以测试下 recast.prettyPrint
const output = recast.print(ast).code;

console.log(output)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>打印输出</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>const add = function(a, b) {
  return a +
    // 有什么奇怪的东西混进来了
    b
};
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="javascript-编译"><a href="#javascript-编译" class="header-anchor">#</a> javascript 编译</h2> <h6 id="v8"><a href="#v8" class="header-anchor">#</a> v8</h6> <h6 id="squirrelfish-extreme"><a href="#squirrelfish-extreme" class="header-anchor">#</a> SquirrelFish Extreme</h6> <h2 id="javascript引擎"><a href="#javascript引擎" class="header-anchor">#</a> JavaScript引擎</h2> <ul><li>什么是虚拟机</li></ul> <blockquote><p>虚拟机是指在既定的计算机系统中运用软件模拟的具有完整硬件系统功能的计算机系统。根据虚拟机的模拟以及代替现实计算机的精确度，它们被分为了很多种类型。其中流程虚拟机的功能性较低，只能运行一道程序或流程。比如，Wine就是一种可以让你在Linux计算机上运行Windows运用程序的流程虚拟机，但它并不能提供一套完整的Windows操作系统。JavaScript引擎是一种为解释和执行JavaScript代码而专门设计的流程虚拟机。</p></blockquote> <ul><li>JavaScript引擎完成了什么事</li></ul> <blockquote><p>JavaScript的基本工作就是将开发者写的JavaScript代码转换成能被浏览器理解甚至能在应用程序上运用的最优化的快捷代码。事实上，JavaScriptCore称自己是优化的虚拟机。<br>
更确切地说，每一个 JavaScript 引擎都实现了ECMAScript的一种版本，而JavaScript 是它的一种方言叫法。JavaScript引擎会随着ECMAScript的发展而进步，因为如此多不同的引擎都要与不同的浏览器一起运作，如headless browser（如PhantomJS）, 或者像Node.js这样的执行环境。<br>
通过以上对虚拟机的定义，将JavaScript引擎称为流程虚拟机也就是理所当然的了。因为它唯一的目的就是要读取和编译JavaScript代码。然而这并不意味着它只是一种简单的引擎。举个例子，JavaScriptCore有6个分区来分析、翻译、优化以及垃圾收集JavaScript代码。</p></blockquote> <ul><li>JavaScript引擎是如何运作的</li></ul> <blockquote><p>这取决于引擎。WebKit的JavaScriptCore以及谷歌的V8引擎之所以能引起我们的兴趣是因为NativeScript对它们起了杠杠作用。这两种引擎不同程度地掌握着过程码。<br>
JavaScriptCore是通过一系列的步骤去编译和优化脚本。<br>
它会对词汇进行分析，将其分解成一系列的记号，或附上某些既定的意义。这些记号之后会被分析程序理出句法，并嵌入句法树。之后4个JIT（及时）程序开始运行、分析和执行那些分析程序产生的字节码。
简单讲，JavaScript引擎将你的源代码分解成串（又叫做分词），再将那些串转换成为编译器能够理解的字节码，然后将其执行。<br>
用C++编写的谷歌的V8引擎也能编译和解释JavaScript源代码，掌握内存记忆配置且可垃圾回收残留物。
它由2个能够将源代码直接转换成计算机代码的编译器组成。</p></blockquote> <p>Full-codegen：输出非优化代码的快速编译器。
Crankshaft：输出快速，优化代码的慢速编译器。</p> <p>如果Crankshaft认为由Full-codegen产生的不够优化的代码需要优化，它将会取而代之，这就是“crankshafting”流程。
有趣的事实：”机轴“是运用在自动化产业中内部氧化引擎里的一个完整的部分。这种众所周知的引擎在更高级的载体也就是V8中有所运用。
若计算机代码是由编译过程产生的，那么这个引擎就会在浏览器中显示出所有的ECMA标准规定的数据类型、操作员、客体和功能，或者任何需要用到它们的运行环境，如NativeScript.</p> <ul><li>JavaScript引擎有哪些
| Browser, Headless Browser, or Runtime  |    JavaScript Engine      |
|----------|:-------------😐
| Mozilla |  Spidermonkey  |
| Chrome  |    V8    |
| Safari  | JavaScriptCore |
| IE and Edge  | Chakra |
| PhantomJS  | JavaScriptCore |
| HTMLUnit	  | Rhino |
| TrifleJS  | V8 |
| Node.js   | V8 |
| io.js   | V8 |</li></ul> <h2 id="webassemble"><a href="#webassemble" class="header-anchor">#</a> WebAssemble</h2> <h2 id="llvm"><a href="#llvm" class="header-anchor">#</a> LLVM</h2></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/NotePro/notes/Performance/" class="prev">
        性能调优
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/NotePro/assets/js/app.842cebdb.js" defer></script><script src="/NotePro/assets/js/2.51c83669.js" defer></script><script src="/NotePro/assets/js/6.9517a1cc.js" defer></script>
  </body>
</html>
